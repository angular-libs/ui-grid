"use strict";!function(){function a(a,b,c){var d,e;for(e=a.length-1;e>=0;e--)d=a[e][b.key]+"",c&&-1==d.indexOf(c)&&a.splice(e,1)}function b(a,b){var c,d;return d=b.key,a.sort(function(a,e){return c=a[d]<e[d]?-1:1,c*b.order})}function c(a,b,c){return{key:a,value:b,filterFn:c}}function d(a,b,c){return{key:a,sortFn:b,order:c}}function e(a,b,c){return{count:a,currentPage:b,totalPageCount:c,totalRecordCount:a*c}}function f(a){return"string"==typeof a.options.src&&"object"==typeof a.options.pager}function g(a){this.filters={},this.masterSrc=[],this.src=[],this.page=[],this.pager=void 0,this.scope=a}function h(a,b){return{key:a,value:b}}function i(a,b){return{key:a,order:b}}function j(a){this.filters=void 0,this.sorter=void 0,this.masterSrc=[],this.pager=void 0,this.scope=a}g.prototype.watcherFn=function(a){var b;a&&(this.masterSrc=a,this.invokeFilterChain(),b=this.pager.currentPage,this.initPager(this.pager),this.getPage(b))},g.prototype.resetSrc=function(){var a=this.src;a.length=0,angular.forEach(this.masterSrc,function(b){a.push(b)})},g.prototype.init=function(a,b,c){function d(a){a&&h.then(function(a){e.watcherFn(a)},function(a){e.watcherFn([]),b.error(a)})}var e,f,g,h;e=this,f=e.scope.options.src,g=e.scope.options.pager,angular.isFunction(f)?(h=c.when(f()),e.scope.$watchCollection(function(){return f()},d)):Array.isArray(f)?(h=c.when(f),e.scope.$watchCollection("options.src",d)):angular.isString(f)?h=c.when(a(f)):e.masterSrc.length=0,e.resetSrc(),e.initPager(g)},g.prototype.initPager=function(a){var b=this;a&&(b.scope.options.pager=e(a.count,1,Math.ceil(b.masterSrc.length/a.count)),b.pager=b.scope.options.pager,b.updatePage(),this.pager.getPage=function(a){b.getPage(a)})},g.prototype.updatePage=function(){var a,b;this.page.length=0,b=(this.pager.currentPage-1)*this.pager.count,b=0>b?0:b;for(var c=1;c<=this.pager.count;c++)angular.isDefined(this.src[b])&&this.page.push(this.src[b]),b++;a=Math.ceil(this.src.length/this.pager.count),this.pager.totalPageCount=0==a?1:a},g.prototype.invokeFilterChain=function(){var a=this;a.resetSrc(),angular.forEach(a.filters,function(b){b.value&&b.filterFn(a.src,b,b.value)})},g.prototype.invokeSort=function(a){var b;a.sortFn(this.src,a),b=this.src.length,this.src.push({}),this.src.length=b,this.pager&&(this.pager.currentPage=1,this.updatePage())},g.prototype.getPage=function(a){a>0&&a<=this.pager.totalPageCount&&(this.pager.currentPage=a,this.updatePage())},g.prototype.updateFilter=function(a,b){this.filters[a].value=b,this.invokeFilterChain(),this.pager&&(this.pager.currentPage=1,this.updatePage())},g.prototype.registerFilter=function(a){this.filters[a.key]=a},g.prototype.getSource=function(){return this.pager?this.page:this.src},j.prototype.getSource=function(){return this.masterSrc},j.prototype.init=function(a,b,c){this.scope.options.src,this.scope.options.pager},j.prototype.registerFilter=function(a){this.filters||(this.filters={}),this.filters[a.key]=a},j.prototype.updateFilter=function(a,b){this.filters[a].value=b},j.prototype.invokeSort=function(a){},j.prototype.load=function(a,b){var c,d,e;d=this,e={count:d.pager.count,page:d.pager.currentPage},c={pager:JSON.stringify(e)},d.sorter&&(c.sorter=JSON.stringify(d.sorter)),d.sorter&&(c.filters=JSON.stringify(d.filters)),a({method:"GET",url:this.scope.options.src,params:c}).success(function(a){d.masterSrc=a.data}).error(function(a){d.masterSrc.length=0})};var k=["$http","$log","$q",function(a,b,c){return{restrict:"A",require:"uiGrid",controller:["$scope",function(d){var e,h;e=this,h=f(d)?new j:new g(d),e.getSource=function(){return h.getSource()},e.getOptions=function(){return d.options},e.registerFilter=function(a){h.registerFilter(a)},e.updateFilter=function(a,b){h.updateFilter(a,b)},e.sort=function(a){h.invokeSort(a)},e.isRemoteGrid=function(){return f(d)},h.init(a,b,c)}],scope:{options:"=uiGrid"}}}],l=[function(){return{restrict:"A",require:["^uiGrid"],scope:!1,link:function(b,d,e,f){var g,i;g=f[0],i=b.$eval(e.uiGridFilter),angular.isDefined(i)||(i=g.isRemoteGrid()?h(e.uiGridFilter,""):c(e.uiGridFilter,"",a)),g.registerFilter(i),b.$watch(e.ngModel,function(a,c){angular.isDefined(a)&&a!=c&&g.updateFilter(i.key,b.$eval(e.ngModel))})}}}],m=[function(){return{restrict:"A",require:"^uiGrid",scope:!1,link:function(a,c,e,f){var g,h;h=a.$eval(e.uiGridSort),g=1,angular.isDefined(h)||(h=f.isRemoteGrid()?i(e.uiGridSort,g):d(e.uiGridSort,b,g)),c.on("click",function(){h.order=-1*h.order,f.sort(h),a.$apply()})}}}],n=[function(){var a="$collection";return{restrict:"A",require:"^uiGrid",template:function(b,c){var d=b.attr("var");return b.removeAttr("ui-grid-repeat"),b.removeAttr("var"),delete c.uiGridRepeat,delete c["var"],b.attr("ng-repeat",d+" in "+a),b[0].outerHTML},replace:!0,scope:{},compile:function(b,c){return{pre:function(b,c,d,e){b[a]=e.getSource()},post:function(a,b,c,d){}}}}}];angular.module("ui.grid",[]),angular.module("ui.grid").directive("uiGrid",k),angular.module("ui.grid").directive("uiGridFilter",l),angular.module("ui.grid").directive("uiGridRepeat",n),angular.module("ui.grid").directive("uiGridSort",m)}();