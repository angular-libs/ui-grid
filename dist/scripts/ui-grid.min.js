"use strict";!function(){function a(a,b,c){var d,e;for(e=a.length-1;e>=0;e--)d=a[e][b.key]+"",c&&-1===d.indexOf(c)&&a.splice(e,1)}function b(a,b){var c;return c=b.key,a.sort(function(a,d){return a[c]===d[c]?0:a[c]<d[c]?-1*b.order:1*b.order})}function c(a,b,c){return{key:a,value:b,filterFn:c}}function d(a,b,c){return{key:a,sortFn:b,order:c}}function e(a){return typeof a.options.remote===!0}function f(a){this.filters={},this.masterSrc=[],this._masterSrc=[],this.src=[],this.page=[],this.pager=a.pager,this.scope=a.scope}function g(a,b,c,d){this.count=a,this.currentPage=b&&b>1?b:1,this.totalPageCount=c&&c>1?c:1,this.totalRecordCount=d}function h(a,b){return{key:a,value:b}}function i(a,b){return{key:a,order:b}}function j(a){var b=this;b.filters=a.filters,b.sorter=a.sorter,b.masterSrc=[],b.pager=a.pager,b.scope=a.scope,g.prototype.getPage=function(a){b.getPage(a)}}f.prototype.watcherFn=function(a){var b;a&&(this.masterSrc=a,this._masterSrc=angular.copy(a),this.invokeFilterChain(),this.pager&&(b=this.pager.currentPage,this.initPager(this.pager),this.getPage(b)))},f.prototype.resetSrc=function(){var a=this.src;a.length=0,this.masterSrc=angular.copy(this._masterSrc),angular.forEach(this.masterSrc,function(b){a.push(b)})},f.prototype.init=function(a,b,c){function d(a){a&&h.then(function(a){e.watcherFn(a)},function(a){e.watcherFn([]),b.error(a)})}var e,f,g,h;e=this,f=e.scope.options.src,g=e.scope.options.pager,angular.isFunction(f.then)?(h=c.when(f),h.then(function(a){e.watcherFn(a)},function(a){e.watcherFn([]),b.error(a)})):angular.isFunction(f)?(h=c.when(f()),e.scope.$watchCollection(function(){return f()},d)):Array.isArray(f)?(h=c.when(f),e.scope.$watchCollection("options.src",d)):angular.isString(f)?h=c.when(a.get(f)):e.masterSrc.length=0,e.scope.options.listeners.beforeLoadingData(),e.resetSrc(),e.scope.options.listeners.afterLoadingData(),e.initPager(g)},f.prototype.initPager=function(a){var b=this;a&&(b.scope.options.pager=new g(a.count,1,Math.ceil(b.getSource().length/a.count),b.getSource().length),b.pager=b.scope.options.pager,b.updatePage(),b.pager.getPage=function(a){b.getPage(a)})},f.prototype.updatePage=function(){var a,b;this.page.length=0,b=(this.pager.currentPage-1)*this.pager.count,b=0>b?0:b;for(var c=1;c<=this.pager.count;c++)angular.isDefined(this.src[b])&&this.page.push(this.src[b]),b++;a=Math.ceil(this.src.length/this.pager.count),this.pager.totalPageCount=0===a?1:a,this.pager.totalRecordCount=this.src.length},f.prototype.getPage=function(a){a>0&&a<=this.pager.totalPageCount&&(this.pager.currentPage=a,this.updatePage())},f.prototype.invokeFilterChain=function(){var a=this;a.resetSrc(),angular.forEach(a.filters,function(b){b.value&&b.filterFn(a.src,b,b.value)})},f.prototype.invokeSort=function(a){var b;a.sortFn(this.src,a),b=this.src.length,this.src.push({}),this.src.length=b,this.pager&&(this.pager.currentPage=1,this.updatePage())},f.prototype.applyFilter=function(){this.scope.options.listeners.beforeLoadingData(),this.invokeFilterChain(),this.pager&&(this.pager.currentPage=1,this.updatePage()),this.scope.options.listeners.afterLoadingData()},f.prototype.updateFilter=function(a,b){this.filters[a].value=b,this.scope.options.manualFilter!==!0&&this.scope.options.applyFilter()},f.prototype.registerFilter=function(a){this.filters[a.key]=a},f.prototype.getSource=function(){return this.pager?this.page:this.src},g.prototype.getCurrentPageFirstIndex=function(){return 0===this.totalRecordCount?0:1===this.currentPage?1:(this.currentPage-1)*this.count+1},g.prototype.getCurrentPageLastIndex=function(){return this.currentPage*this.count<=this.totalRecordCount?this.currentPage*this.count:this.totalRecordCount},j.prototype.getSource=function(){return this.masterSrc},j.prototype.updateSource=function(a){if(this.masterSrc.length=0,a)for(var b=a.length>this.pager.count?this.pager.count:a.length,c=0;b>c;c++)this.masterSrc.push(a[c])},j.prototype.init=function(a,b){this.updatePager(this.scope.options.pager),this.helperServices={http:a,log:b},this.load()},j.prototype.registerFilter=function(a){this.filters||(this.filters={}),this.filters[a.key]=a},j.prototype.updateFilter=f.prototype.updateFilter,j.prototype.applyFilter=function(){this.pager.currentPage=1,this.load()},j.prototype.invokeSort=function(a){this.sorter=new i(a.key,a.order),this.pager.currentPage=1,this.load()},j.prototype.updatePager=function(a){var b=this,c=b.scope.options.pager;if(a){var d=0===a.count||0===a.totalRecordCount?1:Math.ceil(a.totalRecordCount/c.count);c=new g(c.count,c.currentPage,d,a.totalRecordCount)}else c=new g(0,1,1,0);b.scope.options.pager=c,b.pager=c},j.prototype.getPage=function(a){a>0&&a<=this.pager.totalPageCount&&(this.pager.currentPage=a,this.load())},j.prototype.prepareDataRequest=function(){var a,b,c;return b=this,c={count:b.pager.count,page:b.pager.currentPage},a={pager:c},b.sorter&&(a.sorter=b.sorter),b.sorter&&(a.filters=b.filters),a},j.prototype.load=function(){var a=this.prepareDataRequest(),b=this;b.scope.options.listeners.beforeLoadingData(),angular.isFunction(b.scope.options.load)?(b.scope.options.load(b,a),b.scope.options.listeners.afterLoadingData()):b.helperServices.http.get(b.scope.options.src,a).success(function(a){b.updateSource(a.data),b.updatePager(a.pager),b.scope.options.listeners.afterLoadingData()}).error(function(a){b.helperServices.log.error(a),b.updateSource([]),b.updatePager(),b.scope.options.listeners.afterLoadingData()})};var k=["$http","$log","$q",function(b,c,d){function g(b){var c={src:[],filters:{},sorter:{},remote:!1,manualFilter:!1,listeners:{beforeLoadingData:angular.noop,afterLoadingData:angular.noop}},d={count:0,totalRecordCount:0},e={filterFn:a};if(b=angular.extend(c,b),b.pager&&(b.pager=angular.extend(d,b.pager)),b.filters&&b.filters.length>0)for(var f=0;f<b.filters.length;f++)b.filters[f].key&&(b.filters[f]=angular.extend(e,b.filters[f]));return b}return{restrict:"A",require:"uiGrid",controller:["$scope","$timeout",function(a,h){var i,k;i=this,i.getSource=function(){return k.getSource()},i.getOptions=function(){return a.options},i.registerFilter=function(a){k.registerFilter(a)},i.updateFilter=function(a,b){k.updateFilter(a,b)},i.sort=function(a){k.invokeSort(a)},i.isRemoteGrid=function(){return e(a)},a.options=g(a.options),a.options.scope=a,k=e(a)?new j(a.options):new f(a.options),h(function(){if(k.init(b,c,d),a.options.filters&&a.options.filters.length>0)for(var e=0;e<a.options.filters.length;e++)i.registerFilter(a.options.filters[e])}),a.options.applyFilter=function(){k.applyFilter()}}],scope:{options:"=uiGrid"}}}],l=[function(){return{restrict:"A",require:["^uiGrid"],scope:!1,link:function(b,d,e,f){var g,i;g=f[0],i=b.$eval(e.uiGridFilter),angular.isDefined(i)||(i=g.isRemoteGrid()?new h(e.uiGridFilter,""):new c(e.uiGridFilter,"",a)),g.registerFilter(i),b.$watch(e.ngModel,function(a,c){angular.isDefined(a)&&a!==c&&g.updateFilter(i.key,b.$eval(e.ngModel))})}}}],m=[function(){return{restrict:"A",require:"^uiGrid",scope:!1,link:function(a,c,e,f){var g,h;h=a.$eval(e.uiGridSort),g=1,angular.isDefined(h)||(h=f.isRemoteGrid()?new i(e.uiGridSort,g):new d(e.uiGridSort,b,g)),c.on("click",function(){h.order=-1*h.order,f.sort(h),a.$apply()})}}}],n=[function(){var a="$collection";return{restrict:"A",require:"^uiGrid",template:function(b,c){var d=b.attr("var");return b.removeAttr("ui-grid-repeat"),b.removeAttr("var"),delete c.uiGridRepeat,delete c["var"],b.attr("ng-repeat",d+" in "+a),b[0].outerHTML},replace:!0,scope:{},compile:function(){return{pre:function(b,c,d,e){b[a]=e.getSource()},post:angular.noop}}}}];angular.module("ui.grid",[]),angular.module("ui.grid").directive("uiGrid",k),angular.module("ui.grid").directive("uiGridFilter",l),angular.module("ui.grid").directive("uiGridRepeat",n),angular.module("ui.grid").directive("uiGridSort",m)}();