"use strict";!function(){function a(a,b,c){var d,e;for(e=a.length-1;e>=0;e--)d=a[e][b.key]+"",c&&-1==d.indexOf(c)&&a.splice(e,1)}function b(a,b){var c,d;return d=b.key,a.sort(function(a,e){return c=a[d]<e[d]?-1:1,c*b.order})}function c(a,b,c){return{key:a,value:b,filterFn:c}}function d(a,b,c){return{key:a,sortFn:b,order:c}}function e(a,b,c){return{count:a,currentPage:b,totalPageCount:c,totalRecordCount:a*c}}function f(a){return"string"==typeof a.options.src&&"object"==typeof a.options.pager&&a.options.isRemotePaging===!0}function g(a){this.filters={},this.masterSrc=[],this.src=[],this.page=[],this.pager=void 0,this.scope=a}function h(a,b){return{key:a,value:b}}function i(a,b){return{key:a,order:b}}function j(a,b,c,d){return{count:a,currentPage:b,totalPageCount:c,totalRecordCount:d}}function k(a){this.filters=void 0,this.sorter=void 0,this.masterSrc=[],this.pager=void 0,this.scope=a}g.prototype.watcherFn=function(a){var b;a&&(this.masterSrc=a,this.invokeFilterChain(),b=this.pager.currentPage,this.initPager(this.pager),this.getPage(b))},g.prototype.resetSrc=function(){var a=this.src;a.length=0,angular.forEach(this.masterSrc,function(b){a.push(b)})},g.prototype.init=function(a,b,c){function d(a){a&&h.then(function(a){e.watcherFn(a)},function(a){e.watcherFn([]),b.error(a)})}var e,f,g,h;e=this,f=e.scope.options.src,g=e.scope.options.pager,angular.isFunction(f)?(h=c.when(f()),e.scope.$watchCollection(function(){return f()},d)):Array.isArray(f)?(h=c.when(f),e.scope.$watchCollection("options.src",d)):angular.isString(f)?h=c.when(a(f)):e.masterSrc.length=0,e.scope.options.listeners.beforeLoadingData(),e.resetSrc(),e.scope.options.listeners.afterLoadingData(),e.initPager(g)},g.prototype.initPager=function(a){var b=this;a&&(b.scope.options.pager=e(a.count,1,Math.ceil(b.masterSrc.length/a.count)),b.pager=b.scope.options.pager,b.updatePage(),b.pager.getPage=function(a){b.getPage(a)})},g.prototype.updatePage=function(){var a,b;this.page.length=0,b=(this.pager.currentPage-1)*this.pager.count,b=0>b?0:b;for(var c=1;c<=this.pager.count;c++)angular.isDefined(this.src[b])&&this.page.push(this.src[b]),b++;a=Math.ceil(this.src.length/this.pager.count),this.pager.totalPageCount=0==a?1:a},g.prototype.getPage=function(a){a>0&&a<=this.pager.totalPageCount&&(this.pager.currentPage=a,this.updatePage())},g.prototype.invokeFilterChain=function(){var a=this;a.resetSrc(),angular.forEach(a.filters,function(b){b.value&&b.filterFn(a.src,b,b.value)})},g.prototype.invokeSort=function(a){var b;a.sortFn(this.src,a),b=this.src.length,this.src.push({}),this.src.length=b,this.pager&&(this.pager.currentPage=1,this.updatePage())},g.prototype.applyFilter=function(){this.scope.options.listeners.beforeLoadingData(),this.invokeFilterChain(),this.pager&&(this.pager.currentPage=1,this.updatePage()),this.scope.options.listeners.afterLoadingData()},g.prototype.updateFilter=function(a,b){this.filters[a].value=b,1!=this.scope.options.isManualFilter&&this.scope.options.applyFilter()},g.prototype.registerFilter=function(a){this.filters[a.key]=a},g.prototype.getSource=function(){return this.pager?this.page:this.src},k.prototype.getSource=function(){return this.masterSrc},k.prototype.updateSource=function(a){if(this.masterSrc.length=0,a)for(var b=0;a.length;b++)this.masterSrc.push(a[b])},k.prototype.init=function(a,b,c){var d=this.scope.options.pager;this.updatePager(d.count,1,1,0),this.helperServices={http:a,log:b},this.load()},k.prototype.registerFilter=function(a){this.filters||(this.filters={}),this.filters[a.key]=a},k.prototype.updateFilter=function(a,b){this.filters[a].value=b,1!=this.scope.options.isManualFilter&&this.scope.options.applyFilter()},k.prototype.applyFilter=function(){this.load()},k.prototype.invokeSort=function(a){this.sorter=i(a.key,a.value),this.load()},k.prototype.updatePager=function(a){a?this.scope.options.pager=j(a.count,a.currentPage,a.totalPageCount,a.totalRecordCount):this.scope.options.pager=j(0,1,1,0),this.pager=this.scope.options.pager,this.pager.getPage=function(a){self.getPage(a)}},k.prototype.getPage=function(a){a>0&&a<=this.pager.totalPageCount&&(this.pager.currentPage=a,this.load())},k.prototype.prepareDataRequest=function(){var a,b,c;return b=this,c={count:b.pager.count,page:b.pager.currentPage},a={pager:JSON.stringify(c)},b.sorter&&(a.sorter=JSON.stringify(b.sorter)),b.sorter&&(a.filters=JSON.stringify(b.filters)),a},k.prototype.load=function(a,b){var c=this.prepareDataRequest();this.scope.options.listeners.beforeLoadingData(),this.helperServices.http({method:"GET",url:this.scope.options.src,params:c}).success(function(a){this.updateSource(a.data),this.updatePager(a.pager),this.scope.options.listeners.afterLoadingData()}).error(function(a){this.helperServices.log.error(a),this.updateSource(resp.data),this.updatePager(resp.pager),this.scope.options.listeners.afterLoadingData()})};var l=["$http","$log","$q",function(a,b,c){var d={src:[],isRemotePaging:!1,isManualFilter:!1,listeners:{beforeLoadingData:angular.noop,afterLoadingData:angular.noop}};return{restrict:"A",require:"uiGrid",controller:["$scope",function(e){var h,i;h=this,e.options=angular.extend(d,e.options),i=f(e)?new k:new g(e),h.getSource=function(){return i.getSource()},h.getOptions=function(){return e.options},h.registerFilter=function(a){i.registerFilter(a)},h.updateFilter=function(a,b){i.updateFilter(a,b)},h.sort=function(a){i.invokeSort(a)},h.isRemoteGrid=function(){return f(e)},i.init(a,b,c),e.options.applyFilter=function(){i.applyFilter()}}],scope:{options:"=uiGrid"}}}],m=[function(){return{restrict:"A",require:["^uiGrid"],scope:!1,link:function(b,d,e,f){var g,i;g=f[0],i=b.$eval(e.uiGridFilter),angular.isDefined(i)||(i=g.isRemoteGrid()?h(e.uiGridFilter,""):c(e.uiGridFilter,"",a)),g.registerFilter(i),b.$watch(e.ngModel,function(a,c){angular.isDefined(a)&&a!=c&&g.updateFilter(i.key,b.$eval(e.ngModel))})}}}],n=[function(){return{restrict:"A",require:"^uiGrid",scope:!1,link:function(a,c,e,f){var g,h;h=a.$eval(e.uiGridSort),g=1,angular.isDefined(h)||(h=f.isRemoteGrid()?i(e.uiGridSort,g):d(e.uiGridSort,b,g)),c.on("click",function(){h.order=-1*h.order,f.sort(h),a.$apply()})}}}],o=[function(){var a="$collection";return{restrict:"A",require:"^uiGrid",template:function(b,c){var d=b.attr("var");return b.removeAttr("ui-grid-repeat"),b.removeAttr("var"),delete c.uiGridRepeat,delete c["var"],b.attr("ng-repeat",d+" in "+a),b[0].outerHTML},replace:!0,scope:{},compile:function(b,c){return{pre:function(b,c,d,e){b[a]=e.getSource()},post:function(a,b,c,d){}}}}}];angular.module("ui.grid",[]),angular.module("ui.grid").directive("uiGrid",l),angular.module("ui.grid").directive("uiGridFilter",m),angular.module("ui.grid").directive("uiGridRepeat",o),angular.module("ui.grid").directive("uiGridSort",n)}();