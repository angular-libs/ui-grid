"use strict";angular.module("ui.grid",[]),angular.module("ui.grid").directive("uiGrid",function(){return{restrict:"A",require:"uiGrid",controller:"GridCtrl",scope:{options:"=uiGrid"}}}),angular.module("ui.grid").directive("uiGridFilter",function(a,b){return{restrict:"A",require:["^uiGrid"],scope:!1,link:function(c,d,e,f){var g,h;g=f[0],h=c.$eval(e.uiGridFilter),angular.isDefined(h)||(h=g.isRemoteGrid()?new b.RemoteGridFilter(e.uiGridFilter,""):new a.GridFilter(e.uiGridFilter,"",a.simpleFilterFn)),g.registerFilter(h),c.$watch(e.ngModel,function(a,b){angular.isDefined(a)&&a!==b&&g.updateFilter(h.key,c.$eval(e.ngModel))})}}}),angular.module("ui.grid").directive("uiGridRepeat",function(){var a="$collection";return{restrict:"A",require:"^uiGrid",template:function(b,c){var d=b.attr("var");return b.removeAttr("ui-grid-repeat"),b.removeAttr("var"),delete c.uiGridRepeat,delete c["var"],b.attr("ng-repeat",d+" in "+a),b[0].outerHTML},replace:!0,scope:{},compile:function(){return{pre:function(b,c,d,e){b[a]=e.getSource()},post:angular.noop}}}}),angular.module("ui.grid").directive("uiGridSort",function(a,b){return{restrict:"A",require:"^uiGrid",scope:!1,link:function(c,d,e,f){var g,h;h=c.$eval(e.uiGridSort),g=1,angular.isDefined(h)||(h=f.isRemoteGrid()?new b.RemoteGridSorter(e.uiGridSort,g):new a.GridSorter(e.uiGridSort,a.simpleSortFn,g)),d.on("click",function(){h.order=-1*h.order,f.sort(h),c.$apply()})}}}),angular.module("ui.grid").factory("gridUtil",function(a,b,c){function d(a){this.filters={},this.masterSrc=[],this._masterSrc=[],this.src=[],this.page=[],this.pager=a.pager,this.scope=a.scope}function e(a,b,c,d){this.count=a,this.currentPage=b&&b>1?b:1,this.totalPageCount=c&&c>1?c:1,this.totalRecordCount=d}var f={};return f.AbstactGridFilter=function(a,b){this.key=a,this.value=b},f.AbstactGridSorter=function(a,b){this.key=a,this.order=b},f.simpleFilterFn=function(a,b,c){var d,e;for(e=a.length-1;e>=0;e--)d=a[e][b.key]+"",c&&-1===d.indexOf(c)&&a.splice(e,1)},f.simpleSortFn=function(a,b){var c;return c=b.key,a.sort(function(a,d){return a[c]===d[c]?0:a[c]<d[c]?-1*b.order:1*b.order})},f.GridFilter=function(a,b,c){var d=new f.AbstactGridFilter(a,b);return d.filterFn=c,d},f.GridSorter=function(a,b,c){var d=new f.AbstactGridSorter(a,c);return d.sortFn=b,d},f.isRemoteGrid=function(a){return a&&a.options&&a.options.remote===!0},d.prototype.watcherFn=function(a){var b;a&&(this.masterSrc=a,this._masterSrc=angular.copy(a),this.scope.options.listeners.beforeLoadingData.call(this,this.masterSrc),this.invokeFilterChain(),this.pager&&(b=this.pager.currentPage,this.initPager(this.pager),this.getPage(b)),this.scope.options.listeners.afterLoadingData.call(this,this.src))},d.prototype.resetSrc=function(){var a=this.src;a.length=0,this.masterSrc=angular.copy(this._masterSrc),angular.forEach(this.masterSrc,function(b){a.push(b)})},d.prototype.init=function(){function a(a){a&&(h=c.when(a),d(h))}function d(a){a.then(function(a){e.watcherFn(a)},function(a){e.watcherFn([]),b.error(a)})}var e,f,g,h;if(e=this,f=e.scope.options.src,g=e.scope.options.pager,e.scope.options.applyFilter=function(){e.applyFilter()},f&&angular.isFunction(f.then))h=c.when(f),d(h);else if(angular.isFunction(f))e.scope.$watchCollection(function(){return f()},a);else{if(!Array.isArray(f))throw new TypeError("src can be promise,array,function only");e.scope.$watchCollection("options.src",a)}},d.prototype.initPager=function(a){var b=this;a&&(b.scope.options.pager=new e(a.count,1,Math.ceil(b.getSource().length/a.count),b.getSource().length),b.pager=b.scope.options.pager,b.updatePage(),b.pager.getPage=function(a){b.getPage(a)})},d.prototype.updatePage=function(){var a,b;this.page.length=0,b=(this.pager.currentPage-1)*this.pager.count,b=0>b?0:b;for(var c=1;c<=this.pager.count;c++)angular.isDefined(this.src[b])&&this.page.push(this.src[b]),b++;a=Math.ceil(this.src.length/this.pager.count),this.pager.totalPageCount=0===a?1:a,this.pager.totalRecordCount=this.src.length},d.prototype.getPage=function(a){a>0&&a<=this.pager.totalPageCount&&(this.pager.currentPage=a,this.updatePage())},d.prototype.invokeFilterChain=function(){var a=this;a.resetSrc(),angular.forEach(a.filters,function(b){b.value&&b.filterFn(a.src,b,b.value)})},d.prototype.invokeSort=function(a){var b;a.sortFn(this.src,a),b=this.src.length,this.src.push({}),this.src.length=b,this.pager&&(this.pager.currentPage=1,this.updatePage())},d.prototype.applyFilter=function(){this.scope.options.listeners.beforeLoadingData.call(this,this.masterSrc),this.invokeFilterChain(),this.pager&&(this.pager.currentPage=1,this.updatePage()),this.scope.options.listeners.afterLoadingData.call(this,this.src)},d.prototype.updateFilter=function(a,b){this.filters[a].value=b,this.scope.options.manualFilter!==!0&&this.scope.options.applyFilter()},d.prototype.registerFilter=function(a){this.filters[a.key]=a},d.prototype.getSource=function(){return this.pager?this.page:this.src},e.prototype.getCurrentPageFirstIndex=function(){return 0===this.totalRecordCount?0:1===this.currentPage?1:(this.currentPage-1)*this.count+1},e.prototype.getCurrentPageLastIndex=function(){return this.currentPage*this.count<=this.totalRecordCount?this.currentPage*this.count:this.totalRecordCount},f.Grid=d,f.GridPager=e,f}),angular.module("ui.grid").controller("GridCtrl",function(a,b,c,d,e,f,g){var h,i,j;j=function(a){var b={src:[],filters:{},sorter:{},remote:!1,manualFilter:!1,listeners:{beforeLoadingData:angular.noop,afterLoadingData:angular.noop}},d={count:0,totalRecordCount:0},e={filterFn:c.simpleFilterFn};if(a.listeners&&(a.listeners=angular.extend(b.listeners,a.listeners)),a=angular.extend(b,a),a.pager&&(a.pager=angular.extend(d,a.pager)),a.filters&&a.filters.length>0)for(var f=0;f<a.filters.length;f++)a.filters[f].key&&(a.filters[f]=angular.extend(e,a.filters[f]));return a},h=this,h.getSource=function(){return i.getSource()},h.getOptions=function(){return a.options},h.registerFilter=function(a){i.registerFilter(a)},h.updateFilter=function(a,b){i.updateFilter(a,b)},h.sort=function(a){i.invokeSort(a)},h.isRemoteGrid=function(){return c.isRemoteGrid(a)},a.options=j(a.options),a.options.scope=a,i=c.isRemoteGrid(a)?new d.RemoteGrid(a.options):new c.Grid(a.options),b(function(){if(i.init(e,f,g),a.options.filters&&a.options.filters.length>0)for(var b=0;b<a.options.filters.length;b++)h.registerFilter(a.options.filters[b])}),a.options.applyFilter=function(){i.applyFilter()}}),angular.module("ui.grid").factory("remoteGridUtil",function(a,b,c){function d(a){var b,c,d;return c=a,d={count:c.pager.count,page:c.pager.currentPage},b={pager:d},c.sorter&&(b.sorter=c.sorter),c.sorter&&(b.filters=c.filters),b}function e(b){var c=this;c.filters=b.filters,c.sorter=b.sorter,c.masterSrc=[],c.pager=b.pager,c.scope=b.scope,a.GridPager.prototype.getPage=function(a){c.getPage(a)}}var f={};return e.prototype.getSource=function(){return this.masterSrc},e.prototype.updateSource=function(a){if(this.masterSrc.length=0,a)for(var b=a.length>this.pager.count?this.pager.count:a.length,c=0;b>c;c++)this.masterSrc.push(a[c])},e.prototype.init=function(){this.updatePager(this.scope.options.pager),this.load()},e.prototype.registerFilter=function(a){this.filters||(this.filters={}),this.filters[a.key]=a},e.prototype.updateFilter=a.Grid.prototype.updateFilter,e.prototype.applyFilter=function(){this.pager.currentPage=1,this.load()},e.prototype.invokeSort=function(a){this.sorter=new f.RemoteGridSorter(a.key,a.order),this.pager.currentPage=1,this.load()},e.prototype.updatePager=function(b){var c=this,d=c.scope.options.pager;if(b){var e=0===b.count||0===b.totalRecordCount?1:Math.ceil(b.totalRecordCount/d.count);d=new a.GridPager(d.count,d.currentPage,e,b.totalRecordCount)}else d=new a.GridPager(0,1,1,0);c.scope.options.pager=d,c.pager=d},e.prototype.getPage=function(a){a>0&&a<=this.pager.totalPageCount&&(this.pager.currentPage=a,this.load())},e.prototype.load=function(){var a=d(this),e=this;e.scope.options.listeners.beforeLoadingData.call(e,e.src),angular.isFunction(e.scope.options.load)?(e.scope.options.load(e,a),e.scope.options.listeners.afterLoadingData.call(e,e.src)):b.get(e.scope.options.src,a).success(function(a){e.updateSource(a.data),e.updatePager(a.pager),e.scope.options.listeners.afterLoadingData.call(e,e.src)}).error(function(a){c.error(a),e.updateSource([]),e.updatePager(),e.scope.options.listeners.afterLoadingData.call(e,e.src)})},f.RemoteGrid=e,f.RemoteGridFilter=a.AbstactGridFilter,f.RemoteGridSorter=a.AbstactGridSorter,f});